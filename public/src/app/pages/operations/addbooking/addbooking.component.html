<nb-card>
    <nb-card-header>
        Add Booking
    </nb-card-header>
    <nb-card-body>
        <div class="container">
            <div class="row">                
                <div class="col-lg-8 col-12">
                    Customer Name:
                    <mat-form-field class="w-100">
                        <!-- <input aria-placeholder="Pick one" (change)="setCustomer(option)" name="cname" [(ngModel)]="bookings.cname" matInput [matAutocomplete]="custauto"> -->
                        <input aria-placeholder="Pick one"  name="cname" [formControl]="customerCtrl" matInput [matAutocomplete]="custauto" >
                        <mat-autocomplete #custauto="matAutocomplete">
                            <mat-option *ngFor="let option of customer |async" [value]="option.name" (onSelectionChange)="setCustomer(option,$event)">
                                {{ option.name }}
                            </mat-option>
                        </mat-autocomplete>
                    </mat-form-field>
                </div>
                <div style="margin: auto;">
                    <button mat-raised-button color="primary" (click)="addCustomer()">Add Customer</button>
                </div>                
            </div>            
          <form [formGroup]="bookedByForm" class="w-100">
                <div formArrayName="rows">
                    <div class="row" *ngFor="let aRow of bookedByForms.controls; let i=index" [formGroupName]="i">                        
                        <div class="col-lg-3 col-12">
                            <mat-form-field>
                                Name (Booked By)
                                <input formControlName="bookByName" matInput [matAutocomplete]="bookByAuto">
                                <mat-autocomplete #bookByAuto="matAutocomplete">
                                    <mat-option *ngFor="let option of bookBy |async" [value]="option.name" (onSelectionChange)="setBookBy(option,$event,aRow)">
                                        {{ option.name }}
                                    </mat-option>
                                </mat-autocomplete>
                            </mat-form-field>
                        </div>
                        <div class="col-lg-3 col-12">
                            <mat-form-field>
                                Phone No (Booked By)
                                <input matInput formControlName="bookByNo">
                            </mat-form-field>
                        </div>
                        <div class="col-lg-3 col-12">
                            <mat-form-field>
                                Email Id (Booked By)
                                <input matInput formControlName="bookByEmail">
                            </mat-form-field>
                        </div>
                        <div class="col-lg-2 col-10">
                            <mat-form-field>
                                CC ID
                                <input matInput formControlName="CCID">
                            </mat-form-field>
                        </div>                
                        <div class="col-lg-1 col-2">
                            <button mat-icon-button color="primary" *ngIf="i>0" (click)="deleteBookedBy(i)"> <mat-icon>clear</mat-icon></button>
                        </div>
                    </div>
                </div>                
            </form>
            <div class="row pb-10">
                <div class="col-lg-12 col-12">
                    <button mat-raised-button color="primary" (click)="addBookedBy()" style="float:right; margin: 5px;">Add Booked By</button>
                </div>                
            </div>
        </div>
    </nb-card-body>
</nb-card>
<nb-card>
    <nb-card-header>Guests</nb-card-header>
    <nb-card-body>
        <div class="row" style="padding:15px">
            <form [formGroup]="myForm" class="w-100">
                <div formArrayName="rows">                    
                    <div class="row" *ngFor="let aRow of passengerForms.controls; let i=index" [formGroupName]="i">
                        <div class="col-lg-1 col-2">
                            <br>
                            {{i+1}}
                        </div>
                        <div class="col-lg-3 col-10">
                            <mat-form-field>
                                <input matInput formControlName="passenger" (keypress)="filterPass(i)" [matAutocomplete]="passengerAuto" placeholder="Name">
                                <mat-autocomplete #passengerAuto="matAutocomplete">
                                    <mat-option *ngFor="let element of passengers | async" [value]="element.name" (onSelectionChange)="setPassenger(element,$event,aRow)">
                                        {{element.name}}
                                    </mat-option>
                                </mat-autocomplete>
                            </mat-form-field>
                        </div>
                        <div class="col-lg-3 col-5">
                            <mat-form-field class="w-100">
                                <input matInput formControlName="passengerNo" placeholder="Phone No">
                            </mat-form-field>
                        </div>
                        <div class="col-lg-3 col-5">
                            <mat-form-field class="w-100">
                                <input matInput formControlName="passengerEmail" placeholder="Email Id">
                            </mat-form-field>
                        </div>
                        <div class="col-lg-2 col-2">
                            <br>
                            <button mat-icon-button color="primary" *ngIf="i>0" (click)="deleteRow(i)"> <mat-icon>clear</mat-icon></button>
                        </div>
                    </div>                    
                </div>
            </form>                 
            <div class="row ptb-10">
                <div class="col-lg-12 col-12">
                    <button mat-raised-button color="primary" (click)="addRow()" style="float:right; margin: 5px;">Add More Guests</button>
                </div>                
            </div>
        </div>
    </nb-card-body>
</nb-card>
<nb-card>
    <nb-card-body>
        <div class="container">            
            <div class="row">
                <div class="col-lg-3 col-12">
                    <mat-form-field>
                        From
                        <!-- <input placeholder="Pick one" matInput [(ngModel)]="bookings.fromLoc" (change)="setCity(option)" [matAutocomplete]="auto1"> -->
                        <input matInput [formControl]="fromCityCtrl"  [matAutocomplete]="auto1">
                        <mat-autocomplete #auto1="matAutocomplete">
                            <mat-option *ngFor="let option of fromCity | async" [value]="option" (onSelectionChange)="fromCitySelect(option,$event)">
                                {{ option }}
                            </mat-option>
                        </mat-autocomplete>
                    </mat-form-field>
                </div>
                <div class="col-lg-3 col-12">
                    <mat-form-field>
                        To
                        <input matInput [formControl]="toCityCtrl" [matAutocomplete]="auto2">
                        <mat-autocomplete #auto2="matAutocomplete">
                            <mat-option *ngFor="let option of toCity | async" [value]="option" (onSelectionChange)="toCitySelect(option,$event)">
                                {{ option }}
                            </mat-option>
                        </mat-autocomplete>
                    </mat-form-field>
                </div>
                <div class="col-lg-3 col-12">
                    <mat-form-field>
                        Vehicle Group*
                        <!-- <input placeholder="Pick one" matInput [(ngModel)]="bookings.vehicleGroup" (change)="setVehicleGroup(option)" [matAutocomplete]="autoVG"> -->
                        <input matInput [formControl]="vehicleGroupCtrl"  [matAutocomplete]="autoVG">
                        <mat-autocomplete #autoVG="matAutocomplete">
                            <mat-option *ngFor="let option of vehicleGroup | async" [value]="option.name" (onSelectionChange)="setVehicleGroup(option,$event)">
                                {{ option.name }}
                            </mat-option>
                        </mat-autocomplete>
                    </mat-form-field>
                </div>
                <div class="col-lg-3 col-12">
                    <mat-form-field>
                        Duty Type*
                        <!-- <input placeholder="Pick one" matInput [(ngModel)]="bookings.dutyType" (change)="setDutyType(option)" [matAutocomplete]="autoDT"> -->
                        <input matInput [formControl]="dutyTypeCtrl"  [matAutocomplete]="autoDT">
                        <mat-autocomplete #autoDT="matAutocomplete">
                            <mat-option *ngFor="let option of dutyType | async" [value]="option.name" (onSelectionChange)="setDutyType(option,$event)">
                                {{ option.name }}
                            </mat-option>
                        </mat-autocomplete>
                    </mat-form-field>
                </div>                
            </div>                      
            <div class="row">
                <div class="col-lg-3 col-12">
                    <mat-form-field class="w-100">
                        Start Date
                        <input matInput [(ngModel)]="bookings.startDate" [matDatepicker]="startDate" (click)="startDate.open()" readonly name="startDate">
                        <mat-datepicker-toggle matSuffix [for]="startDate"></mat-datepicker-toggle>
                        <mat-datepicker #startDate></mat-datepicker>
                    </mat-form-field>
                </div>
                <div class="col-lg-3 col-12">
                    <mat-form-field class="w-100">
                        End Date
                        <input matInput [(ngModel)]="bookings.endDate" [matDatepicker]="endDate" [min]="bookings.startDate" (click)="endDate.open()" readonly name="endDate">         
                        <mat-datepicker-toggle matSuffix [for]="endDate"></mat-datepicker-toggle>
                        <mat-datepicker #endDate></mat-datepicker>
                    </mat-form-field>
                </div>
                <div class="col-lg-3 col-12">
                    <mat-form-field>
                        Reporting Time
                        <input type="time" matInput [(ngModel)]="bookings.reportingTime" name="reportingTime">
                    </mat-form-field>
                </div>
                <div class="col-lg-3 col-12">
                    <mat-form-field>
                        Start From Garage before(in mins)
                        <input matInput [(ngModel)]="bookings.startFromGarage" name="startFromGarage">
                    </mat-form-field>
                </div>
            </div>            
            <div class="row">
                <!-- <div class="col-lg-3 col-12">
                    
                </div> -->
                <div class="col-lg-3 col-12">
                    <mat-form-field>
                        Extra Kms
                        <input matInput #bookedEmail  name="bookByEmail" [(ngModel)]="bookings.extraKms">
                    </mat-form-field>
                </div>
                <div class="col-lg-3 col-12">
                    <mat-form-field>
                        Extra Hours
                        <input matInput #bookedEmail  name="bookByEmail" [(ngModel)]="bookings.extraHours">
                    </mat-form-field>
                    </div>
                <div class="col-lg-3 col-8">
                    <mat-form-field>
                        Rate:
                        <input matInput name="price" [(ngModel)]="bookings.price">
                    </mat-form-field>
                </div>
                <div class="col-lg-3 col-4">
                    <br>
                    <button mat-raised-button color="primary" (click)="getPrice()">Get Cost</button>
                </div>
            </div>
        </div>
    </nb-card-body>
</nb-card>
<nb-card>
    <nb-card-body>
        <div class="container">           
            <div class="row">
                <div class="col-lg-6 col-12">
                    <div class="row">
                        <div class="col-lg-12 col-12">
                            <h5>
                                Reporting Address 
                                <mat-slide-toggle (change)="reportingAddressChange($event)" style="float:right">Google Maps</mat-slide-toggle>
                            </h5>
                            <mat-form-field *ngIf="reportingAddressMaps==false" class="w-100">
                                <textarea rows="4" matInput placeholder="Reporting Address" [(ngModel)]="bookings.reportingAddress"></textarea>
                            </mat-form-field>
                            <mat-form-field [hidden]="reportingAddressMaps==false" class="w-100">
                                <input matInput placeholder="Reporting Address" autocorrect="off" autocapitalize="off" spellcheck="off" type="text" #searchReporting [(ngModel)]="bookings.reportingAddress" (change)="setReportingAddress($event.target.value)">
                            </mat-form-field>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-12 col-12">
                            <agm-map (mapClick)="mapClickedReporting($event)" [hidden]="reportingAddressMaps==false" [latitude]="latitudeReporting" [longitude]="longitudeReporting" [scrollwheel]="false" [zoom]="zoom" [streetViewControl]="false">
                                <agm-marker 
                                    [latitude]="latitudeReporting"
                                    [longitude]="longitudeReporting"
                                    [markerDraggable]="reportingDraggable"
                                    (dragEnd)="markerReportingDragEnd($event)">
                                    <agm-info-window>
                                        <strong>Reporting Address</strong>
                                    </agm-info-window>            
                                </agm-marker>
                            </agm-map>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6 col-12">
                    <div class="row">
                        <div class="col-lg-12 col-12">
                            <h5>
                                Drop Address
                                <mat-slide-toggle (change)="dropAddressChange($event)" style="float:right">Google Maps</mat-slide-toggle>
                            </h5>
                            <mat-form-field *ngIf="dropAddressMaps==false" class="w-100">
                                <textarea rows="4" matInput placeholder="Drop Address" [(ngModel)]="bookings.dropAddress"></textarea>
                            </mat-form-field>
                            <mat-form-field [hidden]="dropAddressMaps==false" class="w-100">
                                <input matInput placeholder="Drop Address" autocorrect="off" autocapitalize="off" spellcheck="off" type="text" #searchDrop [(ngModel)]="bookings.dropAddress" (change)="setDropAddress($event.target.value)">
                            </mat-form-field>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-12 col-12">
                            <agm-map (mapClick)="mapClickedDrop($event)" [hidden]="dropAddressMaps==false" [latitude]="latitudeDrop" [longitude]="longitudeDrop" [scrollwheel]="false" [zoom]="zoom" [streetViewControl]="false">
                                <agm-marker 
                                    [latitude]="latitudeDrop"
                                    [longitude]="longitudeDrop"
                                    [markerDraggable]="dropDraggable"
                                    (dragEnd)="markerDropDragEnd($event)">
                                    <agm-info-window>
                                        <strong>Drop Address</strong>
                                    </agm-info-window>            
                                </agm-marker>
                            </agm-map>
                        </div>
                    </div>   
                </div>
            </div>            
            <div class="row">
                <div class="col-lg-3 col-12">
                    <mat-form-field matTooltip="Displayed in Duties">
                        Short Reporting Address
                        <input matInput name="shortReportingAddress" [(ngModel)]="bookings.shortReportingAddress">
                    </mat-form-field>
                </div>
                <div class="col-lg-3 col-12">
                    <mat-form-field>
                        Dispatch Center
                        <input matInput [matAutocomplete]="dispatchCenter" [(ngModel)]="bookings.dispatchCenter" [formControl]="branchCtrl">
                        <mat-autocomplete #dispatchCenter="matAutocomplete">
                        <mat-option *ngFor="let element of branch | async" [value]="element.name" (onSelectionChange)="setDispatchCenter(element,$event)">
                            {{element.name}}
                        </mat-option>
                        </mat-autocomplete>
                    </mat-form-field>
                </div>
                <div class="col-lg-3 col-12">
                    <mat-form-field>
                        Flight/Train Number
                        <input matInput [(ngModel)]="bookings.flightTrainNo" name="flightTrainNo">
                    </mat-form-field>
                </div>
                <div class="col-lg-3 col-12">
                    <mat-form-field>
                        PO Number
                        <input matInput #bookedEmail  name="bookByEmail" [(ngModel)]="bookings.poNumber">
                    </mat-form-field>
                    <!-- <mat-form-field>
                        Bill To
                        <mat-select [(ngModel)]="bookings.billTo" name="billTo">
                            <mat-option value="option">Option</mat-option>
                        </mat-select>
                    </mat-form-field> -->
                </div>
            </div>            
            <div class="row">
                <div class="col-lg-6 col-12">
                    <mat-form-field class="w-100">
                        Remarks
                        <textarea matInput name="Remarks"[(ngModel)]="bookings.remarks"></textarea>
                    </mat-form-field>
                </div>
                <div class="col-lg-6 col-12">
                    <mat-form-field class="w-100">
                        Additional Notes
                        <textarea matInput name="operatorNotes"[(ngModel)]="bookings.operatorNotes"></textarea>
                    </mat-form-field>
                </div>                        
            </div>
            <div class="row">
                <div class="col-lg-12 col-12">
                    <mat-checkbox [(ngModel)]="bookings.unconfirmed"> Mark as unconfirmed booking</mat-checkbox>
                </div>
            </div>
            <div class="row ptb-10">
                <div class="col-lg-12 col-12">
                    <button mat-raised-button color="primary" (click)="addBooking()">Add</button>
                </div>
            </div>
        </div>                
    </nb-card-body>
</nb-card>
                    
                              